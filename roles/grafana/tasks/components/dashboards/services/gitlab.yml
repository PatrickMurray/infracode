---
- name: Create temporary service file
  tempfile:
    state: file
    suffix: grafana_dashboard
  register: dashboard_file


- name: Create service dashboard JSON
  template:
    src: service.json.j2
    dest: "{{ dashboard_file.path }}"
  vars:
    service_name: GitLab
    container_name: gitlab


- name: Create service metric dashboard
  community.grafana.grafana_dashboard:
    grafana_url: "{{ grafana.protocol }}://{{ grafana.url }}:{{ grafana.port }}"
    grafana_user: "{{ grafana.admin.username }}"
    grafana_password: "{{ grafana.admin.password }}"

    path: "{{ dashboard_file.path }}"
    folder: Service
    overwrite: True


- name: Remove temporary file
  file:
    path: "{{ dashboard_file.path }}"
    state: absent
